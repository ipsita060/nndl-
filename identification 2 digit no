# 1. Import libraries
import tensorflow as tf
from tensorflow.keras import layers, models
import numpy as np
import matplotlib.pyplot as plt
import cv2  # for loading image

# 2. Load the MNIST dataset
(x_train, y_train), (x_test, y_test) = tf.keras.datasets.mnist.load_data()

print("Train images shape:", x_train.shape)
print("Test images shape:", x_test.shape)

# 3. Normalize pixel values
x_train = x_train.astype("float32") / 255.0
x_test  = x_test.astype("float32") / 255.0

# 4. Flatten images
x_train_flat = x_train.reshape(-1, 28 * 28)
x_test_flat  = x_test.reshape(-1, 28 * 28)

# 5. Build your same feedforward model
model = models.Sequential([
    layers.Input(shape=(784,)),
    layers.Dense(128, activation="relu"),
    layers.Dense(64, activation="relu"),
    layers.Dense(10, activation="softmax")
])

# 6. Compile
model.compile(
    optimizer="adam",
    loss="sparse_categorical_crossentropy",
    metrics=["accuracy"]
)

# 7. Train
model.fit(
    x_train_flat, y_train,
    epochs=5,
    batch_size=64,
    validation_split=0.1
)

# 8. Evaluate
test_loss, test_acc = model.evaluate(x_test_flat, y_test, verbose=0)
print(f"\nTest accuracy: {test_acc:.4f}")



# 9. IDENTIFY 2-DIGIT NUMBER FROM YOUR OWN IMAGE


image_path = "/content/mnist3.jpg"   # <---- PUT YOUR IMAGE FILE HERE

# Load image in grayscale
img = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
if img is None:
    raise ValueError("Image not found. Check the image_path.")

# Resize the image to 56×28 (two MNIST digits side by side)
img = cv2.resize(img, (56, 28))

# Split into two 28×28 digit images
left_digit  = img[:, :28]
right_digit = img[:, 28:]

# Normalize each digit
left_digit  = left_digit.astype("float32") / 255.0
right_digit = right_digit.astype("float32") / 255.0

# Flatten each digit
left_flat  = left_digit.reshape(1, 784)
right_flat = right_digit.reshape(1, 784)

# Predict each digit
left_probs  = model.predict(left_flat, verbose=0)[0]
right_probs = model.predict(right_flat, verbose=0)[0]

left_pred  = np.argmax(left_probs)
right_pred = np.argmax(right_probs)

# Combine → 2-digit number
two_digit_number = left_pred * 10 + right_pred

print("\nPredicted Left Digit :", left_pred)
print("Predicted Right Digit:", right_pred)
print("Predicted 2-Digit Number:", two_digit_number)

# Show separated images
plt.figure(figsize=(6, 3))

plt.subplot(1, 2, 1)
plt.imshow(left_digit, cmap="gray")
plt.title(f"Left Digit: {left_pred}")
plt.axis("off")

plt.subplot(1, 2, 2)
plt.imshow(right_digit, cmap="gray")
plt.title(f"Right Digit: {right_pred}")
plt.axis("off")

plt.show()
